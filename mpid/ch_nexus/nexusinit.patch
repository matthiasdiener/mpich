26,27d25
< #include "system/system.h"
< /* #CMMD DECLARATION# */
28a27
> 
136a136,158
> 
> #ifdef NEXUS_ARCH_MPL
> extern void *_nx_st_mpl_info();
> extern void *_nx_st_fork_info();
> extern void *_nx_st_rsh_info();
> extern void *_nx_st_ss_info();
> extern void *_nx_pr_mpl_info();
> extern void *_nx_pr_tcp_info();
> extern void *_nx_database_file_info();
> 
> static nexus_module_list_t module_list[] =
> {
>     {"startups", "mpl", _nx_st_mpl_info},
>     {"startups", "fork", _nx_st_fork_info},
>     {"startups", "rsh", _nx_st_rsh_info},
>     {"startups", "ss", _nx_st_ss_info},
>     {"protocols", "mpl", _nx_pr_mpl_info},
>     {"protocols", "tcp", _nx_pr_tcp_info},
>     {"database", "file", _nx_database_file_info},
>     { NULL, NULL, NULL},
> };
> #endif
> 
140a163,166
> #ifndef FORTRANM
>     nexus_node_t *orig_nodes;
>     int n_orig_nodes;
> 
145c171,194
< PIiInit( argc, argv );
---
> #ifdef NEXUS_ARCH_MPL
>     nexus_init(argc, argv,
> 	       "MPI_ARGS", "mpi",
> 	       NULL, NULL, NULL,
> 	       module_list,
> 	       &orig_nodes, &n_orig_nodes);
> #else
>     nexus_init(argc, argv,
>     	       "MPI_ARGS", "mpi",
> 	       NULL, NULL, NULL, NULL,
> 	       &orig_nodes, &n_orig_nodes);
> #endif
> 
>     nexus_start_nonblocking();
> 
>     if (orig_nodes)
>     {
>         MPID_NEXUS_setup_nodes(orig_nodes, n_orig_nodes);
>         MPID_NEXUS_publicize_nodes(argc, argv);
>     }
> 
>     MPID_NEXUS_wait_for_gps(argc, argv);
> #endif /* FORTRANM */
> 
149a199,202
> #if defined(NEXUS_ARCH_MPL)
>     signal(SIGALRM, SIG_IGN);
> #endif
> 
154c207
< SYSetResourceClockOff();
---
> ;
172,175c225
< fprintf( stderr, "[%d] Aborting program!\n", MPID_MyWorldRank );
< fflush( stderr );
< fflush( stdout );
< SYexitall( (char *)0, code );
---
>     nexus_fatal("Aborting program!\n");
198c248
< PIiFinish();
---
> MPID_NEXUS_finalize();
205c255
< PINodeName( name, len );
---
> gethostname( name, len );
285,287c335
< if (str) 
<     fprintf( stderr, "[%d] %s\n", MPID_MyWorldRank, str );
< MPID_NEXUS_Abort( code );
---
>     nexus_fatal("%s\n", str);

#  (C) 1993 by Argonne National Laboratory and Mississipi State University.
#      All rights reserved.  See COPYRIGHT in top-level directory.
#
SHELL = /bin/sh
MAKE = @MAKE@ 
LN_S = @LN_S@
RM = rm
CP = cp

top_srcdir=@top_srcdir@

includebuild_dir=@includebuild_dir@
htmlbuild_dir=@htmlbuild_dir@
manbuild_dir=@manbuild_dir@

SLOG_HEADERS = slog.h fbuf.h \
               slog_header.h slog_preview.h slog_pstat.h slog_ttable.h \
               slog_profile.h slog_recdefs.h slog_strlist.h

SLOG_EXES    = slog_printbbufs@EXEEXT@ slog_printframes@EXEEXT@ \
               slog_readtest@EXEEXT@ slog_recdefs_test@EXEEXT@ \
               ts_incrEQendtime_resfnEQno@EXEEXT@ \
               ts_incrEQendtime_resfnEQyes@EXEEXT@ \
               ts_incrEQstarttime@EXEEXT@

all:	build_links sloglib build_include build_man build_html

build_links:
	-@if [ ! -d test ] ; then mkdir test ; fi
	-@cd test ; \
	for file in ${SLOG_EXES} ; do \
	    if [ ! -h $$file ] ; then \
	        $(LN_S) ../bin/$$file $$file ; \
	    fi ; \
	done; \
	if [ ! -h slog_print@EXEEXT@ ] ; then \
	    $(LN_S) ./slog_printbbufs@EXEEXT@ slog_print@EXEEXT@ ; \
	fi
	-@cd bin; \
	if [ ! -h slog_print@EXEEXT@ ] ; then \
	   $(LN_S) ./slog_printbbufs@EXEEXT@ slog_print@EXEEXT@ ; \
	fi

build_include:
	-@if [ -n "$(includebuild_dir)" ] ; then \
	      if [ ! -d $(includebuild_dir) ] ; then \
	          mkdir -p $(includebuild_dir) ; \
	      fi ; \
	      cd $(top_srcdir)/include ; \
	      for file in $(SLOG_HEADERS) ; do \
	          if [ -f $$file -a ! -f $(includebuild_dir)/$$file ] ; then \
	              $(CP) $$file $(includebuild_dir) ; \
	          fi ; \
	      done ; \
	  fi

build_man:
	-@if [ -n "$(manbuild_dir)" ] ; then \
	      if [ ! -d $(manbuild_dir) ] ; then \
	          mkdir -p $(manbuild_dir) ; \
	      fi ; \
	      if [ ! -d $(manbuild_dir)/man3 ] ; then \
	          mkdir $(manbuild_dir)/man3 ; \
	      fi ; \
	      cd $(top_srcdir)/doc/man/man3 ; \
	      for file in *.3 ; do \
	          if [    -f $$file \
	               -a ! -f $(manbuild_dir)/man3/$$file ] ; then \
	              $(CP) $$file $(manbuild_dir)/man3 ; \
	          fi ; \
	      done ; \
	  fi

build_html:
	-@if [ -n "$(htmlbuild_dir)" ] ; then \
	      if [ ! -d $(htmlbuild_dir) ] ; then \
	          mkdir -p $(htmlbuild_dir) ; \
	      fi ; \
	      cd $(top_srcdir)/doc/html ; \
	      for file in *.html ; do \
	          if [ -f $$file -a ! -f $(htmlbuild_dir)/$$file ] ; then \
	              $(CP) $$file $(htmlbuild_dir) ; \
	          fi ; \
	      done ; \
	  fi

sloglib:
	@if [ -s src/Makefile ] ; then ( cd src ; $(MAKE) ) ; fi

install:
	@if [ -n "$(PREFIX)" ] ; then \
	     ./sbin/install-slog -prefix=$(PREFIX) ; \
	 else \
	     ./sbin/install-slog ; \
	 fi

uninstall:
	@-./sbin/uninstall-slog

rmlinks:
	-cd test; $(RM) -f $(SLOG_EXES) slog_print@EXEEXT@
	-cd bin; $(RM) -f slog_print@EXEEXT@

rmlib:
	-@if [ -s src/Makefile ] ; then ( cd src ; $(MAKE) rmlib ); fi

rmprog:
	-@if [ -s src/Makefile ] ; then ( cd src ; $(MAKE) rmprog ); fi

clean:	
	-@if [ -s src/Makefile ] ; then ( cd src ; $(MAKE) clean ) ; fi

distclean: rmlinks
	-if [ -s src/Makefile ] ; then ( cd src ; $(MAKE) distclean ) ; fi
	@-$(RM) -f sbin/install-slog sbin/uninstall-slog
	@-$(RM) -f Makefile slog_config.h config.log config.status

configure: configure.in aclocal.m4
	autoheader
	autoconf
